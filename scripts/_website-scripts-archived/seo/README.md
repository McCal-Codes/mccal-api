# SEO Scripts (`scripts/seo/`)

## Overview

Scripts for generating SEO assets from portfolio API data:
- XML sitemaps with image entries
- Schema.org structured data (JSON-LD)
- Automated search engine submissions

---

## Scripts

### `generate-sitemap.js`

**Purpose**: Generate XML sitemap from portfolio manifests

**Usage**:
```bash
npm run seo:sitemap

# Or directly
node scripts/seo/generate-sitemap.js
```

**Environment Variables**:
- `API_BASE` - API server URL (default: `http://localhost:3001`)
- `SITE_URL` - Production site URL (default: `https://mccalmedia.com`)

**Output**: `dist/sitemap.xml`

**What it does**:
1. Fetches all portfolio manifests from API
2. Generates static page entries (home, about, portfolios)
3. Generates individual item entries (bands, events, etc.)
4. Includes image entries with metadata for each item
5. Writes XML with proper structure and validation

**Example output**:
```xml
<url>
  <loc>https://mccalmedia.com/concerts/funky-lamp</loc>
  <lastmod>2024-01-15</lastmod>
  <changefreq>monthly</changefreq>
  <priority>0.7</priority>
  <image:image>
    <image:loc>https://mccalmedia.com/images/Portfolios/Concert/Funky%20Lamp/January%202024/240115_001.jpg</image:loc>
    <image:title>Funky Lamp - January 15, 2024</image:title>
    <image:caption>Mr. Smalls Theatre</image:caption>
  </image:image>
</url>
```

---

### `generate-structured-data.js`

**Purpose**: Generate Schema.org structured data for rich search results

**Usage**:
```bash
npm run seo:schema

# Or directly
node scripts/seo/generate-structured-data.js
```

**Environment Variables**:
- `API_BASE` - API server URL (default: `http://localhost:3001`)
- `SITE_URL` - Production site URL (default: `https://mccalmedia.com`)

**Output**: `dist/structured-data/*.json`

**Files created**:
- `concert-schema.json` - Concert portfolio schema
- `events-schema.json` - Events portfolio schema
- `journalism-schema.json` - Journalism portfolio schema
- `portrait-schema.json` - Portrait portfolio schema
- `all-schemas.json` - Combined schemas

**What it does**:
1. Fetches each portfolio manifest from API
2. Generates ImageGallery Schema.org structure
3. Includes sample images and metadata
4. Adds author/copyright information
5. Writes JSON-LD format files

**Example output**:
```json
{
  "@context": "https://schema.org",
  "@type": "ImageGallery",
  "name": "Concert Photography Portfolio",
  "description": "Professional concert photography by Caleb McCartney...",
  "url": "https://mccalmedia.com/concerts",
  "image": ["https://...", "https://..."],
  "author": {
    "@type": "Person",
    "name": "Caleb McCartney",
    "jobTitle": "Photographer & Photojournalist"
  },
  "numberOfItems": 215,
  "datePublished": "2025-11-23"
}
```

---

## Combined Command

**Run both generators**:
```bash
npm run seo:all
```

This runs:
1. `seo:sitemap` - Generate sitemap
2. `seo:schema` - Generate structured data

---

## Quick Demo

**Test the full SEO pipeline**:
```bash
npm run api:demo-seo
```

This will:
1. Start API server in background
2. Wait for API to be ready
3. Generate sitemap and structured data
4. Show completion message

---

## Automation

### GitHub Actions

SEO assets are automatically generated by `.github/workflows/seo-auto-update.yml` when:
- Portfolio images change
- Manifest scripts change
- API routes change

**See**: [SEO Automation Guide](../../docs/integrations/seo-automation-guide.md)

### Workflow Steps

1. Install dependencies
2. Generate manifests (`npm run manifest:generate`)
3. Start API server
4. Generate sitemap (`npm run seo:sitemap`)
5. Generate structured data (`npm run seo:schema`)
6. Validate XML and JSON
7. Commit changes if detected
8. Submit sitemap to Google

---

## Validation

### Sitemap Validation

```bash
# Check sitemap exists
test -f dist/sitemap.xml && echo "âœ“ Sitemap exists"

# Count URLs
grep -c '<loc>' dist/sitemap.xml

# Count images
grep -c '<image:loc>' dist/sitemap.xml

# Validate XML structure
grep -q '<?xml version="1.0"' dist/sitemap.xml && echo "âœ“ Valid XML"
```

### Structured Data Validation

```bash
# Validate all JSON files
for file in dist/structured-data/*.json; do
  jq empty "$file" && echo "âœ“ $file valid"
done

# Count schema files
find dist/structured-data -name '*.json' | wc -l

# Test with Google
# Visit: https://search.google.com/test/rich-results
# Paste contents of dist/structured-data/concert-schema.json
```

---

## Integration

### Search Console Submission

**Google Search Console**:
```bash
# Manual ping
curl "https://www.google.com/ping?sitemap=https://mccalmedia.com/sitemap.xml"
```

**Bing Webmaster Tools**:
```bash
# Requires API key
curl -X POST "https://ssl.bing.com/webmaster/api.svc/json/SubmitUrlbatch?apikey=YOUR_KEY" \
  -H "Content-Type: application/json" \
  -d '{"siteUrl":"https://mccalmedia.com","urlList":["https://mccalmedia.com/sitemap.xml"]}'
```

### Using in Widgets

Widgets can include structured data directly:

```html
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ImageGallery",
  "name": "Concert Photography",
  ...
}
</script>
```

Load from generated files:

```javascript
// In widget or page
fetch('/structured-data/concert-schema.json')
  .then(r => r.json())
  .then(schema => {
    const script = document.createElement('script');
    script.type = 'application/ld+json';
    script.textContent = JSON.stringify(schema);
    document.head.appendChild(script);
  });
```

---

## Customization

### Add New Portfolio Type

Edit both scripts to include new type:

```javascript
// In both generate-sitemap.js and generate-structured-data.js
const PORTFOLIOS = ['concert', 'events', 'journalism', 'portrait', 'YOUR_NEW_TYPE'];
```

Scripts auto-discover structure from API manifest endpoints.

### Change Output Paths

```javascript
// In scripts
const OUTPUT_PATH = path.join(__dirname, '../../dist/sitemap.xml');
const OUTPUT_DIR = path.join(__dirname, '../../dist/structured-data');
```

### Adjust Priorities

```javascript
// In generate-sitemap.js
urls.push({
  loc: `${SITE_URL}/${type}`,
  changefreq: 'weekly',  // Change frequency hint
  priority: 0.9          // Priority hint (0.0-1.0)
});
```

---

## Troubleshooting

### API Not Running

```
Error: ECONNREFUSED http://localhost:3001
```

**Fix**: Start API first: `npm run api:start &`

### Missing Manifests

```
Error: Cannot read property 'bands' of undefined
```

**Fix**: Generate manifests: `npm run manifest:generate`

### Invalid XML

```
Error: Invalid sitemap XML
```

**Fix**: Check for special characters in band names/titles. Script should escape automatically.

### Empty Output

```
Sitemap contains 0 URLs
```

**Fix**: 
1. Verify API is serving manifests: `curl http://localhost:3001/api/v1/manifests/concert`
2. Check manifest files exist in `src/images/Portfolios/`
3. Ensure portfolio structure matches expected format

---

## Performance

### Optimization Tips

1. **Cache API responses**: Scripts fetch fresh data each time
2. **Limit image entries**: Currently limited to 5 images per item
3. **Run in background**: Use `&` to not block terminal
4. **Use CI/CD**: Automate generation on image changes

### Typical Execution Times

- Sitemap generation: 2-5 seconds (depends on portfolio size)
- Structured data: 1-3 seconds per portfolio
- Full run (`npm run seo:all`): ~10 seconds

---

## References

- [SEO Benefits Guide](../../docs/integrations/api-seo-benefits.md)
- [SEO Automation Guide](../../docs/integrations/seo-automation-guide.md)
- [API Integration Guide](../../docs/integrations/api-integration-guide.md)
- [Google Sitemap Protocol](https://www.sitemaps.org/protocol.html)
- [Schema.org ImageGallery](https://schema.org/ImageGallery)

---

## Maintenance

### Regular Tasks

- [ ] Monitor sitemap submission status in Search Console
- [ ] Validate rich results in Google's testing tool
- [ ] Check workflow success after large photo batches
- [ ] Review generated schemas for accuracy
- [ ] Update author info if needed
- [ ] Add new portfolios to scripts when created

### When to Regenerate

- âœ… After adding new photos (automatic via CI)
- âœ… After changing portfolio structure
- âœ… After updating manifest formats
- âœ… When API endpoints change
- âœ… When site URL changes

---

**ðŸŽ¯ Your SEO is automated and always current!**
