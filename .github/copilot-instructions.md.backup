# McCal Media API - Copilot Instructions

## Purpose

This file defines agent behavior and workspace guardrails for the **McCal Media API** repository. This is a companion API service that works alongside the McCals-Website repo to serve portfolio data dynamically.

## TODO Tree Extension Compatibility

All TODO/task files must use standard tags like `TODO`, `FIXME`, `BUG`, etc., and/or markdown checklists (`- [ ]`, `- [x]`) for VS Code Todo Tree compatibility.

- Use `TODO:` or `FIXME:` at the start of a line or after a comment marker
- For markdown, use checklist items (`- [ ]` for incomplete, `- [x]` for complete)
- When adding a TODO in code, also add an entry in updates/todo.md or updates/done.md for traceability

## Repository Overview

**Architecture Role:**
- **This repo (mccal-api)**: REST API service for dynamic manifest serving, caching, and data endpoints
- **McCals-Website repo**: Static widgets, Squarespace integration, manifest generation
- **Integration**: Widgets consume this API for live data; API serves manifests with Redis caching and CORS

**Key Technologies:**
- Node.js + Express (REST API)
- Redis (caching layer)
- Cloudflare Workers/Pages (deployment target)
- CORS configuration for Squarespace domains

## Agent Responsibilities

- **Always read these instructions first** when starting any session in this workspace
- **Update these instructions** when discovering new patterns or API conventions
- **Add entries to Recent updates** section for significant changes
- **Update main README.md** when making architectural changes to endpoints, caching, or deployment

## Source Layout

```
mccal-api/
├── src/
│   └── api/
│       ├── server.js          # Express server entry point
│       ├── routes/            # API route handlers
│       │   ├── health.js      # Health check endpoint
│       │   ├── manifests.js   # Manifest CRUD operations
│       │   ├── blog.js        # Blog RSS/content endpoints
│       │   ├── webhooks.js    # GitHub/external webhooks
│       │   └── admin.js       # Admin/privileged endpoints
│       ├── versions/          # API versioning
│       │   └── v1/            # Version 1 routes
│       ├── config/            # Configuration files
│       │   └── manifests.js   # Manifest type definitions
│       ├── cache/             # Redis cache client
│       │   └── redis-client.js
│       └── proxy-middleware.js # Proxy utilities
├── scripts/                   # Utilities and tooling
│   ├── utils/                 # Cache warming, health checks
│   ├── admin/                 # Deployment, monitoring scripts
│   └── manifest/              # Manifest sync from website repo
├── docs/                      # API documentation
│   ├── deployment/            # Cloudflare deployment guides
│   ├── integrations/          # Widget integration patterns
│   └── standards/             # API conventions, security
└── package.json
```

## API Development Workflow

### Local Development

```bash
# Install dependencies
npm install

# Start dev server (with auto-reload)
npm run api:dev

# Start production mode
npm run api:start
```

Server runs on `http://localhost:3001` by default (configurable via `API_PORT` env var).

### Adding New Endpoints

1. Create route handler in `src/api/routes/` or add to existing route file
2. Import and mount in appropriate version router (`src/api/versions/v1/index.js`)
3. Add CORS origin if needed in `src/api/server.js`
4. Document endpoint in `docs/integrations/api-integration-guide.md`
5. Update README.md with new endpoint specification

## Copilot instructions for McCal Media API

### Manifest Consumption

This API can consume manifests from the website repo via:
- **Submodule mount**: Website repo at `src/manifests/` (git submodule)
- **File sync**: Copy manifests from website repo during CI/deployment
- **Direct file path**: Read from local file system in development

Manifest files are typically at paths like:
- `src/images/Portfolios/Concert/concert-manifest.json`
- `src/images/Portfolios/Events/events-manifest.json`
- Etc.

### Caching Strategy

- **Redis cache**: Primary caching layer for manifest data
- **Cache warming**: On startup, preload all manifests into Redis
- **TTL**: Configurable per manifest type (default: 1 hour for dynamic, 24 hours for static)
- **Invalidation**: Webhook endpoint to invalidate cache when website repo updates manifests

### CORS Configuration

- Allow Squarespace domains (`.squarespace.com`, `.sqsp.com`)
- Allow production domain (`mccalmedia.com` or custom domain)
- Support preflight (`OPTIONS`) requests
- Return proper `Access-Control-*` headers

### API Response Patterns

- Always return JSON with proper `Content-Type: application/json`
- Include `ETag` header for cacheable responses
- Return `Cache-Control` headers for client-side caching
- Standard error format: `{ error, message, timestamp }`

Source layout you'll use most

- `src/widgets/` primary deliverables (selfcontained HTML widgets with inline CSS/JS). Each widget has its own README and versioned files.
- `src/images/` portfolio assets consumed by widgets and local test site.
- `src/site/` local demo app (`index.html`, `app.js`, `styles.css`) to preview data flows and layouts.
- `scripts/` Node scripts for organizing photos and generating manifests.
- `dist/` build output (generated). Do not edit by hand.

Before large changes

- Run preflight validation: `npm run ai:preflight:short` or VS Code task "AI: Preflight (short)" to validate context awareness.
- Read widget-specific READMEs before modifying widgets: `src/widgets/*/README.md` contain embedding instructions and performance notes.

Run/build/deploy workflows

- Node >= 16. Install once with `npm install`.
- Local dev server: `npm run dev` (serves `src/site/` via `dev-server.js` on http://localhost:3000; opens browser). Production-like: `npm run serve`.
- Build static site: `npm run build` (copies `src/site/` and `src/images/` to `dist/`).
- Optional test-site deploys: `npm run deploy` (interactive) or `deploy:netlify|vercel|surge`. The real production site is Squarespace.
- Watchers (auto-regenerate): `npm run watch:auto-manifest` (Concerts), `npm run watch:events-manifest`, `npm run watch:journalism-manifest`, `npm run watch:universal`.

Platform tip (Windows)

- Helper: `scripts/win-generate-universal-manifest.ps1` can run the universal manifest generator on Windows.

Images and manifests pipeline (critical)

- Required structure (Concerts): `src/images/Portfolios/Concert/<Band Name>/<Month Year>/*.jpg` (spaces allowed).
- Generate manifests: `npm run manifest:generate` (auto mode), or per-type: `manifest:concert`, `manifest:events`, `manifest:journalism`, `manifest:universal`.
- Watch for changes (auto-regenerate): `npm run watch:auto-manifest` (logs to `logs/auto-manifest.log`).
- Generator details: `scripts/enhanced-manifest-generator.js` extracts dates from filenames (YYMMDD, YYYYMMDD, some DD-MM-YY cases like `13-01-24` 2024-12-13) or EXIF (`DateTime`, `DateTimeOriginal`). Writes `manifest.json` in each date folder and `processing-summary.json` at Concert root.
- Do not hand-edit generated `manifest.json` files; change images/folders and re-run generators instead. Use `npm run manifest:cleanup` if you reorganize bands.

Key manifest outputs

- Per-folder (Concert): `src/images/Portfolios/Concert/<Band>/<Month Year>/manifest.json`
- Concert rollup: `src/images/Portfolios/Concert/concert-manifest.json`
- Events rollup: `src/images/Portfolios/Events/events-manifest.json`
- Journalism rollup: `src/images/Portfolios/Journalism/journalism-manifest.json`
- Universal rollup: `src/images/Portfolios/portfolio-manifest.json`
- Summary: `src/images/Portfolios/Concert/processing-summary.json`

CI automation

- `.github/workflows/build-manifest.yml` runs on pushes touching `src/images/Portfolios/Concert/**` and regenerates/commits concert manifests (uses Node 20). Features retry logic, JSON validation, and robust error handling.
- Similar jobs exist for Events and Journalism: `events-manifest.yml` and `journalism-manifest.yml` watch `src/images/Portfolios/{Events|Journalism}/**` with full error recovery.
- Emergency recovery: `regenerate-all-manifests.yml` can manually regenerate any combination of manifests with force option.
- Health monitoring: `workflow-health-check.yml` runs daily to validate all manifest files and generation scripts.
- All workflows include: retry logic (3 attempts), JSON validation, data integrity checks, proper error reporting.
- Docs guard: `copilot-instructions-guardian.yml` reminds/fails PRs when core flows change without updating `.github/copilot-instructions.md`, and requires a `CHANGELOG.md` entry when the instructions change (bypass labels: `docs-acknowledged`, `skip-copilot-instructions`).

Widget authoring conventions

- Widgets are drop-in HTML for Squarespace Code Blocks: inline CSS, minimal JS, no external fonts; prefer self-contained assets. See `src/widgets/**/README.md` for usage.
- Self-contained architecture: Each widget HTML file contains all CSS/JS inline to avoid external dependencies in Squarespace.
- Versioning: keep versioned HTML files (e.g., `versions/v2.5.3-event-portfolio.html`) and update per-widget CHANGELOGs if present; repo-level policy is in `docs/standards/versioning.md`.
- Don't couple widgets to the local test site; widgets read from manifests and/or remote assets. Keep selectors/namespaces stable for Squarespace.
- Performance patterns: Use CSS columns for masonry layouts, intersection observers for progressive loading, and intelligent caching for GitHub API calls.
- Configuration via data attributes: Widgets use `data-panes`, `data-category` etc. for Squarespace customization without code changes.

Widget status workflow

- **Production ready**: If widget works properly → add to "Available Widgets" in main README
- **Work in progress**: If widget needs work → create `STATUS.md` file, add to "Work in Progress" section
- **Archive unused**: Move complete directory to `src/widgets/_archived/` if no longer needed
- **Status guide**: See `src/widgets/widget-status-guide.md` for complete workflow and criteria

Local test site patterns (for previews only)

- `src/site/app.js` is a vanilla JS SPA demo that reads manifests (example: Funky Lamp folder `manifest.json`, expects fields like `images[]`, `totalImages`, optional `concertDate.{year,month,day,iso}`). If you change manifest shapes, update generators and this app together.

Integration points and external deps

- Scripts use Node fs/path and `exif-parser` to read EXIF; avoid shell-specific assumptions (works on Windows/macOS/Linux). Optional CLIs for deploys: `netlify-cli`, `vercel`, `surge`.

Safe-change checklist for agents

- Add/modify images under `src/images/**`; never commit edits to `dist/**`.
- Run manifests before testing: `npm run manifest:generate` or start the watcher.
- Keep widget code self-contained; don't import from the test app.
- Preserve folder naming (Band/Month Year) and filename date patterns when possiblegenerators rely on them.
- If adding scripts, follow existing patterns (`scripts/*.js`, crossplatform Node only). If changing manifest fields, update: generator, CI, docs, and any consumers in `src/site/` and widgets that read them.
- Widget versioning: Create new version files in `src/widgets/[name]/versions/` rather than editing existing versions.
- Test locally: Use `npm run dev` to preview widgets in test harness before Squarespace deployment.
- **Widget preview workflow**: When testing widgets, let the user preview them in VS Code's built-in browser or locally first, then have the user describe what they see or what issues they encounter rather than automatically hosting on external servers.
- Performance: Monitor widget performance with `?debug=true` URL parameter and `window.portfolioAPI.getMetrics()` in console.

Workflow troubleshooting

- **Manifest generation fails**: Use GitHub Actions "Regenerate All Manifests" workflow with force option to recover
- **Path errors**: All manifest workflows expect `src/images/Portfolios/` structure (not `images/Portfolios/`)
- **JSON validation fails**: Workflows include automatic JSON validation with jq; invalid JSON will fail with clear error messages
- **Retry failures**: Workflows attempt generation 3 times with 5-second delays; persistent failures indicate script or data issues
- **Manual recovery**: Access Actions tab → "Regenerate All Manifests" → "Run workflow" to force regeneration of specific manifests
- **Health monitoring**: Check "Workflow Health Check" results for daily validation of all manifest files and scripts

Widget performance and debugging

- **Performance Standards**: All widgets must follow `docs/standards/performance-standards.md` for Lighthouse optimization. Use Concert Portfolio v4.6 as the primary performance reference implementation.
- **Performance Regression CI**: A headless Playwright-based performance scaffold runs basic metrics and uploads HTML reports; Lighthouse integration will follow.
- Debug mode: Add `?debug=true` to any widget URL to enable performance overlays and metrics
- Console access: Use `window.portfolioAPI.getMetrics()` in browser console for cache hit rates and API performance
- Lightbox patterns: Widgets use fixed positioning with z-index 2147483647, hidden scrollbars, and pointer-events blocking
- Error resilience: Widgets implement exponential backoff, graceful degradation, and "Coming Soon" fallback cards
- CSS patterns: Masonry layouts use CSS columns with `break-inside: avoid`, progressive loading with intersection observers

Good starting references

- `scripts/enhanced-manifest-generator.js` — manifest schema and date logic.
- `scripts/watch-auto-manifest.js` — recommended dev loop.
- `src/widgets/**/README.md` — embedding instructions and constraints.
- `src/site/app.js` — example data flow from manifests to UI.
- `docs/standards/widget-reference.md` ⭐ **START HERE**: quick reference for widget development patterns.
- `docs/standards/widget-standards.md` — comprehensive widget standards and architecture guide.
- `docs/standards/widget-development.md` — comprehensive guide for applying enhancement patterns systematically.
- `docs/standards/performance-standards.md` ⭐ **PERFORMANCE REFERENCE**: Lighthouse optimization standards using Concert Portfolio v4.6 as case study.
- `docs/standards/accessibility-patterns.md` ⭐ **ACCESSIBILITY REFERENCE**: WCAG 2.1 AA compliance patterns with code examples for skip navigation, focus management, keyboard controls, mobile drawers, scroll spy, ARIA, reduced motion, and color contrast. Reference implementation: Accessibility Statement Widget v1.0.
- `docs/standards/image-seo-standards.md` — comprehensive guide for optimizing portfolio images for search engines and accessibility.

Change management

- When you update this file, add a brief entry to `CHANGELOG.md` under Docs/Meta noting what changed. A PR check will remind/fail if missing.

Scripts folder organization and archival (2025-10-06)

- All scripts must be organized by function: `manifest/` for manifest generators, `watchers/` for watchers, `utils/` for utilities, `admin/` for admin/import tools. Do not place new scripts directly in the root `scripts/` folder.
- Any script not referenced by npm scripts, not used by widgets, or not part of the active automation pipeline should be moved to `scripts/_archived/`.
- When archiving, move the file and add a comment/header indicating it is not actively used.
- Before adding new scripts, check for existing patterns and update the relevant README in each subfolder.
- After any reorganization, validate all npm scripts and workflows to ensure nothing is broken.
- Document all changes in this instruction file and in the main `CHANGELOG.md` under Docs/Meta.
- Periodically review the scripts folder for unused or obsolete files and archive as needed.
- Always keep the scripts folder clean and efficient to avoid confusion and ensure maintainability.

Recent updates

- 2025-12-03T00:00:00.000Z — Private API Integration Plan (Cloudflare + Submodule).
  - Established plan to migrate `src/api` into a private repo `McCal-Codes/mccal-api` and consume it in this workspace via a Git submodule mounted at `src/api`.
  - Cloudflare: will host the API at `https://api.mcc-cal.com` using Workers or Pages Functions with CORS for Squarespace and site domains. DNS routed via Cloudflare; SSL/TLS managed automatically.
  - CORS/Auth: Allow preflight (`OPTIONS`), permit `Content-Type`, `Authorization`, `X-API-Key`; restrict privileged routes with bearer tokens; return `ETag`/`Cache-Control` for GETs.
  - CI: Site repo workflows that require submodules must use `actions/checkout@v4` with `submodules: true` and PAT/SSH secrets. API repo will have its own deploy workflow using a least-privilege Cloudflare API token stored in GitHub Actions secrets.
  - Documentation: migration runbook added under `scripts/admin/migrate-api-to-submodule.md`. Matching `TODO:` entry added to `updates/todo.md` per Todo Tree rules.
- 2025-11-29T00:00:00.000Z — Pre-publish and Validation CI enhancements.

  - Added prepublish workflow for widget tag releases: runs AI Preflight, widget validation, manifest dry-run, uploads artifacts.
  - Upgraded widget validation CI to publish reports and allow manual dispatch.
  - Introduced README audit utility to enforce active-version policy (current + previous, x.x.0 format) and archive linkage.

- 2025-11-23T00:00:00.000Z — Version Standardization Complete (x.x.0 Format)

  - Problem: Version dropdowns sorting incorrectly (v1.10 appearing before v1.9) due to inconsistent version formats (some x.x, some x.x.0).
  - Solution: Standardized all versions to Semantic Versioning 2.0.0 format (x.x.0) throughout repository.
  - Implementation:
    - Created automation scripts: `standardize-versions.js` (content updates) and `rename-widget-versions.js` (file renaming)
    - Renamed 63 widget version files: vX.Y.html → vX.Y.0.html (concert: 19, photojournalism: 12, podcast: 12, featured: 6, others: 14)
    - Updated 33+ widget HTML files (Version: headers) and 10+ script files (@version tags)
    - Updated 13 documentation files with corrected version references
    - Added 4 npm scripts for future maintenance: versions:standardize, versions:check, versions:rename, versions:rename-check
    - Created comprehensive guide: `docs/standards/version-standardization-guide.md`
  - Key Lessons Learned:
    1. **Automation is Essential**: Manual updates are error-prone; automation saves time and ensures consistency (63 files renamed in seconds vs hours manually)
    2. **Dry-Run Mode Critical**: Always implement `--dry-run` mode for mass operations; provides confidence and prevents mistakes
    3. **Semantic Versioning Benefits**: Proper x.x.0 format fixes sorting issues and maintains professional standards
    4. **Comprehensive Documentation**: Guide prevents future confusion and provides clear standards for new versions
    5. **File Naming Patterns**: Script handles complex patterns (suffixes like v1.4.0-debug.html) with regex flexibility
    6. **Git Rename Tracking**: Git properly tracks file renames, maintaining history and making changes reversible
    7. **Cascading Updates**: File renames require documentation updates; comprehensive grep searches essential
  - Future Maintenance: Use `npm run versions:check` before updates; reference standardization guide for new versions; automation tools ready for future standardizations.
  - Validation: All changes committed successfully; 100 files changed (63 renamed, 37 content updated); ready for production.

- 2025-11-19T18:00:00.000Z — Repository Reorganization Phase 1 (Archival & CI Shadow Workflow).\n+\t- Established centralized legacy versions archive: `src/widgets/_archived/legacy-widget-versions/` with per-widget `INDEX.json` (concert, photojournalism, featured) for traceability.\n+\t- Standardized active vs legacy version policy (retain current + previous stable in live widget directories; defer physical relocation of older versions to Phase 2 for controlled multi-file move).\n+\t- Updated widget READMEs (concert, photojournalism, featured) to list only active versions and reference archive index for historical lookup.\n+\t- STATUS.md standardization: applied unified template (Phase, Exit Criteria, Next Review) to `blog-feed`, `nature-portfolio`, `admin-portfolio-importer`; removed obsolete STATUS files from production widgets.\n+\t- Added orphan script audit utility `scripts/utils/orphan-audit.js` (result: 43 total scripts, 35 referenced, 8 orphans) to inform future archival decisions; Phase 2 will relocate or document remaining orphans (`generate-cdn-snippets.js`, `auto-check-todo.js`, etc.).\n+\t- Consolidated deploy placeholder scripts into single `deploy:placeholder` to reduce noise and guide manual deployment steps.\n+\t- Introduced composite shadow manifest workflow `.github/workflows/manifest-composite.yml` (matrix: concert, events, journalism, nature, portrait, universal) to validate consolidation before retiring per-portfolio workflows.\n+\t- Deferred physical relocation of legacy version HTML files (Phase 2) to avoid large atomic patch; TODO entries added for controlled migration with validation pass post-move.\n+\t- Next: Perform Phase 2 legacy file relocation, archive orphan scripts, and (after shadow workflow proves stable) decommission individual manifest workflows.\n+\t- Validation pending after instructions update: run AI Preflight (short), widget HTML validator, repo health check.\n+\n+- 2025-11-11T00:30:00.000Z — Accessibility Statement Widget v1.1.2 (Forced Theme Semantics Correction).\n+\t- Added new version file: `src/widgets/accessibility-statement/versions/v1.1.2-accessibility-statement.html`.\n+\t- Corrected Light/Dark semantics: Light = dark text on light panel/background; Dark = light text on dark panel/background.\n+\t- System mode unchanged; all IDs/anchors preserved.\n+\t- Updated README (current version v1.1.2) and CHANGELOG with [1.1.2] entry documenting correction and WCAG AA contrast verification.\n+\t- HTML validator: PASS.\n+\t- Note: v1.1.1 (inverted modes) remains available but superseded for standard semantics.\n\*\*\* End Patch

- 2025-11-11T00:00:00.000Z — Policies & Legal Widget v1.1.0 (Accessibility Enhancements).

  - Created new version file: `src/widgets/policies-legal/versions/v1.1.0-policies-legal-squarespace.html`.
  - Added skip link, unified focus-visible styling, aria-current scroll spy, reduced-motion support, refined print styles, and hardened landmarks.
  - Improved mobile drawer behavior: closes on link/overlay/Escape; `aria-expanded` synchronized.
  - Updated README and CHANGELOG; CDN snippet now points to v1.1.0.
  - HTML validator: PASS.

- 2025-11-10T12:00:00.000Z — Interactive Thesis Widget v0.1-minimal.

  - Created self-contained thesis prototype widget with scroll-reveal, accessible Story Drawer (ESC + click-away, focus trap), and demo audio transcript.
  - File: `src/widgets/interactive-thesis/versions/v0.1-minimal.html`. README added with usage instructions.
  - Local preview build system added: `scripts/thesis/build-thesis-interactive.js` (esbuild + Tailwind via PostCSS) with outputs at `/thesis/interactive` and route alias `.../thesis/interactive`.
  - NPM scripts: `build:thesis`, `dev:thesis`.
  - HTML validator: PASS. Next: run Lighthouse and accessibility checks; optionally add page-level SEO when promoted beyond widget embed.

- 2025-11-10T12:30:00.000Z — Interactive Thesis Widget v0.2 (Podcast Excerpts + Inline Thesis Placeholders).

  - New version file: `src/widgets/interactive-thesis/versions/v0.2-excerpts-inline-thesis.html` with a structured thesis section (Abstract, Introduction, Methodology, Findings, Conclusion) and an excerpts grid tied to podcast episodes.
  - Google Docs cannot be auto-fetched without auth; paste real thesis text into the marked TODO blocks.
  - Excerpts include inline audio previews using audio URL time ranges and link to full episodes.
  - HTML validator: PASS.

- 2025-11-10T13:15:00.000Z — Interactive Thesis Widget v0.3 (Live Thesis Embed + Blog-styled Excerpts).
  - New version file: `src/widgets/interactive-thesis/versions/v0.3-thesis-live-excerpts.html` embedding the published Google Doc (auto-updates on edits) and restyling podcast thesis excerpts using blog-grid/blog-card patterns for visual consistency.
  - Accessibility: semantic article cards with roles, aria-live grid updates, toolbar buttons with `aria-pressed`, reduced motion respected.
  - Performance: media fragment audio time-range previews (hash time ranges) with no preload, column-count masonry for efficient layout, single IntersectionObserver reveal.
  - Validation: HTML validator PASS. Changelog and README updated.
- 2025-11-10T13:45:00.000Z — Interactive Thesis Widget v0.4 (Blog-formatted Thesis, No Live Embed).

  - New version file: `src/widgets/interactive-thesis/versions/v0.4-thesis-blog-format.html` removes the live Google Docs iframe; thesis sections rendered as standalone blog cards with chips.
  - Excerpts retained with keyboard navigation (arrows) + Enter to toggle audio; empty filter state added.
  - Accessibility: list/listitem roles, distinct placeholder styling for TODO sections, reduced motion support preserved.
  - Performance: static content (no cross-origin embed), lazy audio (no preload), single IntersectionObserver for reveal.
  - Validation: HTML validator PASS; README and CHANGELOG updated.

- 2025-11-10T00:00:00.000Z — Events performance + taxonomy updates.

  - Image optimization: compressed oversized JPEG/PNG files in Events (≈66.9% average savings across initial batch); verified outputs and removed temporary backups.
  - WEBP variants: added generator support and produced .webp companions for Events images; manifests updated to reference new assets.
  - Category extension: introduced a General category in Events manifest logic and classified “Yinzers Meet Hike” as General.
  - Widget behavior: no widget code change required for filters—Event Portfolio v2.6.x auto-discovers categories and will surface “General” alongside existing filters. “Performance Art” continues to display as “Arts” via label mapping.
  - Validation: regenerated events-manifest.json; spot-check confirms Yinzers Meet Hike now shows category "General" and WEBP assets are listed.
  - Notes/Next: optional follow-up to prefer WEBP sources in widget image selection (low-risk enhancement) and consider subheading copy to reflect outdoor/general events.

- 2025-11-03T16:39:33.003Z — Completed workflow validation system and portrait portfolio automation. Added comprehensive health checks and updated standards documentation.
- 2025-11-04T12:10:00.000Z — Manifest simplification & Portrait Portfolio v1.1 release (migration & hardening).
  - Fixed a runtime initialization error in the Portrait Portfolio widget by restoring and hardening the structured-data helper; widget now recovers gracefully when manifests or images are missing.
  - Implemented Portrait widget v1.1 features: client-first-name extraction for titles, dynamic subject tabs (auto-discovered from manifest collections), rotating selection (1–4 images randomized per session with round-robin pooling), improved lightbox UX (safe-area close button, hidden scrollbars), and debug-panel improvements.
  - Optimized manifest generation pipeline:
    - Generators now perform idempotent writes (skip writing aggregated manifest files when unchanged) to reduce churn.
    - Added `--force` support to key generators so maintainer/CI can overwrite manifests intentionally.
    - Updated `scripts/watchers/watch-auto-manifest.js` to trigger portfolio-level generators and forward `--force` when requested.
    - Migrated to a single aggregated manifest per portfolio (e.g., `portrait-manifest.json`, `concert-manifest.json`) and deprecated per-folder `manifest.json` outputs.
    - Created and executed `scripts/manifest/remove-subfolder-manifests.js` to clean legacy per-folder manifests.
  - CI/workflows updated: removed attempts to add per-folder `manifest.json` files and now operate solely on aggregated manifests; workflows still generate, validate (jq), and commit aggregated manifests with rollback/backup safety.
  - Documentation updates: added a Single-Portfolio Manifest Policy note to `docs/standards/workspace-organization.md`, updated widget README/CHANGELOG for Portrait v1.1, and added guidance in workflow comments about the cleanup script.
  - Validation & verification: regenerated manifests (`npm run manifest:generate`), ran the manifest validator (`node scripts/utils/validate-manifests.js`) — result: 8 aggregated manifest files checked, 0 errors. Commits created for all changes; changes are reversible via git history.
  - Helpful commands:
    - Clean up legacy manifests: `node scripts/manifest/remove-subfolder-manifests.js`
    - Watch and force regeneration locally: `node scripts/watchers/watch-auto-manifest.js --all --force`
    - Regenerate all manifests: `npm run manifest:generate`
    - Validate manifests: `node scripts/utils/validate-manifests.js`
  - Notes/Next steps: update any external tooling that still expects per-folder manifests; optionally update watchers/CI for other repos or add a CI cleanup check. If you want, I can update additional workflows or run the dev-server smoke test for the Portrait widget (requires explicit permission).
- 2025-11-03T12:00:00.000Z — Workflow validation system complete: Fixed corrupted ci-validate-workflows.js script, added comprehensive workflow validation with script reference checking and best practices (npm ci, caching). Added portrait-manifest.yml workflow for Portrait portfolio automation. Completed full repository health validation including smoke tests, AI preflight, large files check, widget validation, and workflow validation. All systems functioning properly with automated workflows for all portfolio types.
- 2025-11-02T12:00:00.000Z — Concert Portfolio v4.7 refinement: deduplicated artist list (case-insensitive) in Spotify panel and added interaction safety so the support button is temporarily disabled while interacting with images or when the lightbox is open.
- 2025-11-02T00:00:00.000Z — Concert Portfolio v4.7: Added non-intrusive Spotify support button listing bands from the concert manifest with “Open on Spotify” search links and optional embedded previews via inline JSON artist map. Retains v4.6 performance optimizations and accessibility patterns. README and widget CHANGELOG updated.
- 2025-10-28T23:59:00.000Z — Policies & Legal v1.0.0 hotfix: fixed top comment closure to eliminate stray "-->" rendering. Revalidated widget (PASS). Download button wired via data-terms-pdf with fallback remains intact; floating menu and version badge interactions confirmed.
- 2025-01-27T18:30:00.000Z — Created Policies & Legal Widget v1.0.0: Comprehensive legal documentation page with sidebar navigation featuring Terms & Conditions (23 sections), Privacy Policy, Cookie Policy, Usage License, FAQ (7 questions), and Contact. SEO-enhanced with WebPage, BreadcrumbList, and FAQPage schemas. Full accessibility with ARIA labels, semantic HTML, and keyboard navigation. Responsive mobile drawer menu. Unsplash-inspired clean design with dark/light mode support. Auto-updating effective date and copyright year. Added to main README available widgets list. Complete documentation (README, CHANGELOG) created.
- 2025-10-24T23:14:01.897Z — Successfully created Portrait Portfolio v1.0 widget - portrait photography showcase with vertical composition focus, 3:4 aspect ratios, enhanced detail viewing, performance optimizations, and SEO features. Added to available widgets list and created sample manifest.
- 2025-10-24T22:21:24.272Z — Successfully implemented podcast widget v1.9.5 with auto-hydrating RSS episodes. Added Ep 9 fallback data, live RSS caching, and updated show branding. Created test page that works properly. Widget now auto-populates new episodes without manual updates.
- 2025-10-09T17:15:26.708Z — Close Button Optimization and Navigation Hiding pattern implemented
- 2025-10-09T17:30:00.000Z — Photojournalism Portfolio Widget v5.2 complete: Glass-like filter buttons with backdrop blur, Fisher-Yates shuffle with one image per album, adjacency minimization, excluded Events folder/Rooney events, simplified All/Published filters, muted green Published accent, updated subheading for political work focus. Added comprehensive changelog entries to both widget CHANGELOG.md and internal modal. All changes validated and production-ready.
- 2025-10-08T10:00:00.000Z — About page widget v1.4.4 updated: Refreshed bio to reflect alumni status from Point Park, freelance photographer/photojournalist work, Globe photo editor role over last fall, client work extending into summer, and Kentucky project collaboration. Enhanced contact options with clean dropdown menu offering email and Calendly coffee chat booking. Removed non-functional blog button, updated portfolio link to /featured-work. Improved contact UX with elegant slide-down menu and proper Calendly integration.
- 2025-10-06T23:41:05.924Z — Session complete: minor updates.
- 2025-10-06T23:40:47.789Z — Created comprehensive SEO starter guide document tailored for McCal Media's Squarespace implementation, covering site structure, titles/meta descriptions, image optimization, structured data, internal linking, and technical hygiene. Added to docs/standards/ and updated main README and CHANGELOG.
- 2025-10-06T22:05:00.000Z — Updated copilot instructions to reference new performance standards document and establish Concert Portfolio v4.6 as the primary performance reference implementation for all widgets. Added performance standards to good starting references with priority star rating.
- 2025-10-06T21:59:34.417Z — Fixed concert portfolio widget v4.6 image loading and layout issues. Updated CSS to use responsive column-width layout with overlay info styling, matching journalism widget patterns. Images now load properly in masonry-style grid with smooth transitions and loading animations.
- 2025-10-06T21:54:49.562Z — Created performance-optimized concert portfolio widget v4.6 with critical CSS inlining, modern JavaScript patterns, and reduced main-thread blocking. Addresses PageSpeed issues: render blocking resources, unused CSS/JS, and long tasks.
- 2025-10-06T22:00:00.000Z — Repository cleanup: Removed entire `tests/` directory containing obsolete test files, debug artifacts, and site workspace backups. Repository structure simplified and professionalized. All test files archived and committed for record-keeping.
- 2025-10-06T21:42:37.712Z — Fixed structured data detection issues in concert portfolio widget v4.5. Updated addBasicStructuredData function to properly calculate total images from manifest bands, generate absolute image URLs, and add comprehensive metadata. Added debug functionality to check structured data locally. Structured data now includes proper Schema.org ImageGallery markup with image URLs, author info, and SEO metadata.
- 2025-10-06T21:37:13.763Z — Successfully implemented SEO enhancements for concert portfolio widget v4.5 including structured data, enhanced alt text generation, and accessibility improvements. Images are now loading properly and SEO features are working.
- 2025-10-06T21:30:00.000Z — Created `docs/standards/image-seo-standards.md` documenting comprehensive SEO best practices for portfolio images including alt text, file naming, structured data, lazy loading, and accessibility standards for improved search engine optimization and user experience.
- 2025-10-06T21:19:20.735Z — Session complete: minor updates.
- 2025-10-06T21:19:09.064Z — Successfully tested and fixed VS Code tasks for Copilot AI workflow. Fixed PowerShell quoting issues in widget validation task, created proper Node.js validation script, and verified all core tasks work correctly.
- 2025-10-06T21:13:03.271Z — Session complete: minor updates.
- 2025-10-05T16:00:00.000Z **CRITICAL LESSON LEARNED**: Event portfolio widget debugging session revealed critical pattern - widget lightbox system is extremely fragile. v2.6.0 works perfectly, but v2.6.1, v2.6.2, and v2.6.3 all broke when trying to "upgrade" functionality. **Key insight**: NEVER mix incompatible patterns. Always copy complete working systems (CSS+HTML+JS together) or build from stable foundation. Created `docs/standards/widget-debugging-lessons.md` with emergency recovery protocol. **Latest stable**: v2.6.0 (perfect), v2.6.2 (has changelog but lightbox issues). Future agents must read debugging lessons before widget modifications.
- 2025-10-05T15:00:00.000Z Event Portfolio v2.6.0 enhancement complete: Applied journalism widget v4.9 patterns to event portfolio. Fixed lightbox image stretching (`object-fit: contain`, `display: block`, `margin: 0 auto`), added hidden scrollbars for immersive experience, enhanced navigation hiding with comprehensive selectors, improved close button with fixed positioning and accessibility, integrated version indicator in heading, comprehensive debug panel with detailed metrics and controls. All v2.5.6 optimizations retained. Remaining widget (featured) still needs similar enhancements.
- 2025-10-05T14:00:00.000Z Concert Portfolio v4.4 enhancement complete: Applied journalism widget v4.9 patterns to concert portfolio. Fixed lightbox image stretching (`object-fit: contain`, `display: block`, `margin: 0 auto`), added hidden scrollbars for immersive experience, enhanced navigation hiding with comprehensive selectors, improved close button with fixed positioning and accessibility, integrated version indicator in heading, comprehensive debug panel with detailed metrics and controls. All v4.3 optimizations retained.
- 2025-10-05T13:00:00.000Z Manifest workflow reliability complete: Enhanced all manifest workflows (concert, events, journalism) with comprehensive auto/manual operation support. Added backup/restore system, widget compatibility validation, retry logic (3 attempts), JSON validation with jq, rollback on failure, concurrency protection. Created emergency recovery workflow (`regenerate-all-manifests.yml`) and daily health monitoring (`workflow-health-check.yml`). All workflows now include proper error reporting, data integrity checks, and widget protection mechanisms. Verified working: events manifest (4 events, 84 images), concert manifest (16 bands, 211 images), all generation scripts functional. GitHub Actions workflows now bulletproof and never break existing widgets.
- 2025-10-05T07:48:39.389Z — Updated test widgets to latest versions - journalism widget updated from v3.0 to v4.9 with latest features
- 2025-10-05T12:30:00.000Z Admin Portfolio Importer v1.1.0 complete: Created secure admin-only widget for importing and organizing portfolio images with backend API integration. Features authentication, smart folder detection, preview system, and automatic manifest generation. Includes comprehensive documentation (README, CHANGELOG) and production-ready status. Backend server handles file uploads, date extraction, and folder organization following workspace conventions.
- 2025-10-05T12:00:00.000Z Photojournalism widget v4.9 lightbox fix: Fixed image stretching in lightbox gallery by adding `object-fit: contain`, `display: block`, and `margin: 0 auto` to preserve aspect ratios and prevent distortion. Images now maintain proper proportions regardless of viewport size. Follows same pattern as event portfolio widget for consistency across widget family.
- 2025-10-05T06:15:00.000Z Widget standardization documentation complete: Created comprehensive `widget-standards.md` establishing consistent patterns across all widget types (portfolio, navigation, content, hero). Added `widget-reference.md` as quick development checklist. Documented architecture standards, CSS patterns, performance guidelines, accessibility requirements, and debug patterns. Simplified all file names from UPPER-CASE-NAMES.md to lowercase-names.md for better organization. Updated docs organization and copilot instructions to reference new standardization guides.
- 2025-10-05T06:00:00.000Z Widget enhancement framework complete: Created comprehensive `widget-development.md` providing systematic methodology for applying proven patterns across all widgets. Updated photojournalism README with enhancement pattern references. Established quality assurance standards, implementation checklists, and continuous improvement processes. All workspace rules validated and documentation aligned.
- 2025-10-05T01:45:00.000Z Photojournalism widget optimization complete (v4.4→v4.8): Fixed Published Work filter functionality, enhanced filtering UX (no gaps), minimal status indicators, comprehensive navigation hiding in lightbox, hidden scrollbars for immersive experience. Created comprehensive widget enhancement patterns documentation (`docs/standards/widget-enhancements.md`) cataloging proven improvements for systematic application across all widgets.
- 2025-10-05T00:30:00.000Z Footer widget v1.2.0 compliance: Removed modal functionality for simplified UX, updated README and CHANGELOG documentation, added to main README Available Widgets list. Widget now fully compliant with workspace standards including accessibility, performance patterns, and self-contained architecture.
- 2025-10-05T00:00:00.000Z Widget optimization updates: Enhanced site-navigation v1.6.3 with improved blur effects, hover states, and performance optimizations. Created site-footer v1.2.0 with CSS custom properties, enhanced accessibility, mobile optimizations, and comprehensive compliance with workspace standards.
- 2025-10-04T11:30:00.000Z Widget status organization: Archived GitHub portfolio to src/widgets/\_archived/, marked blog feed and nature portfolio as work-in-progress with STATUS.md files. Updated README to show 7 production widgets + 2 WIP. Created archival system for widget management.
- 2025-10-04T11:26:00.000Z Updated main README.md to v2.4.0: Added comprehensive repository organization details, expanded widget list, organized documentation structure, AI development support, and maintenance guidelines. Added agent responsibility to keep README current with major changes.
- 2025-10-04T11:22:00.000Z Documentation organization complete: Reorganized docs into categories (workflows/, automation/, integrations/, standards/, archive/) and test files into organized structure (tests/html/). Updated all references and paths.
- 2025-10-04T11:19:00.000Z Repository organization complete: Moved 15+ test files from root to organized tests/html/ structure, relocated deployment scripts to scripts/, cleaned up temporary files. Root directory now clean and professional.
- 2025-10-04T00:00:00.000Z Enhanced copilot instructions with architecture overview, performance patterns, widget authoring conventions, and comprehensive development workflow guidance
- 2025-10-04T00:00:00.001Z Added agent responsibilities and widget preview workflow guidance: agents must read/update instructions and use user-driven preview workflow instead of external hosting
- 2025-10-03T09:15:17.082Z Featured Portfolio Widget v1.5 complete: Enhanced journalism titles, ultra-minimal scrollbars (4px, 0.15 opacity), improved masonry spacing (16px gaps), randomized cover images with Fisher-Yates shuffle, minimal gray accents (color 888888), production-ready deployment with 15-item limit, scrollable lightbox, and comprehensive changelog documentation
- 2025-10-03T09:15:11.674Z Session complete: minor updates.
- 2025-10-03T07:08:00.400Z Fixed featured portfolio widget by creating generate-featured-manifest.js script and updated widget to v1.2 with better debugging
- 2025-10-03T06:29:14.357Z Validation: preflight/guardian/canvas/codex added and tasks wired
- Entries below are appended by the AI finalize script to record what the last agent session changed.
  **Start Here:** For workspace/process standards, scripts organization, and validation checklists, see [docs/standards/workspace-organization.md](../docs/standards/workspace-organization.md).
